<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groseloa - Transaction</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="navbar">
        <a href="#" onclick="history.back()">&lsaquo; Cancel</a>
        <span id="page-title">Transaction</span>
    </div>

    <div class="container">
        <h2 id="tx-header">Amount</h2>

        <form id="transaction-form">
            <div class="form-group">
                <label for="amount">Amount (Rupees)</label>
                <input type="number" id="amount" name="amount" required placeholder="0.00" step="0.01"
                    style="font-size: 2em; text-align: center;">
            </div>

            <div class="form-group">
                <label for="description">Description (Optional)</label>
                <input type="text" id="description" name="description" placeholder="e.g. Rice, Sugar, Payment">
            </div>

            <button type="submit" id="submit-btn" class="btn">Confirm</button>
        </form>
    </div>

    <script src="js/app.js"></script>
    <script>
        const customerId = getQueryParam('customerId');
        const type = getQueryParam('type'); // CREDIT or PAYMENT

        if (type === 'CREDIT_ADD') {
            document.getElementById('page-title').innerText = "Give Credit (Udhaar)";
            document.getElementById('tx-header').innerText = "Enter Credit Amount";
            document.getElementById('submit-btn').innerText = "Confirm Credit";
            document.getElementById('submit-btn').classList.add('btn-danger');
        } else if (type === 'PAYMENT') {
            document.getElementById('page-title').innerText = "Accept Payment";
            document.getElementById('tx-header').innerText = "Enter Payment Amount";
            document.getElementById('submit-btn').innerText = "Confirm Payment";
            document.getElementById('submit-btn').classList.add('btn-primary');
        } else if (type === 'ADVANCE_ADD') {
            document.getElementById('page-title').innerText = "Add Advance (Deposit)";
            document.getElementById('tx-header').innerText = "Enter Advance Amount";
            document.getElementById('submit-btn').innerText = "Confirm Advance";
            document.getElementById('submit-btn').style.backgroundColor = 'var(--primary-color)';
            document.getElementById('submit-btn').style.color = 'white';
        } else if (type === 'PURCHASE') {
            document.getElementById('page-title').innerText = "Purchase (from Advance)";
            document.getElementById('tx-header').innerText = "Enter Purchase Amount";
            document.getElementById('submit-btn').innerText = "Confirm Purchase";
            document.getElementById('submit-btn').style.backgroundColor = '#f59e0b';
            document.getElementById('submit-btn').style.color = 'white';
        }

        document.getElementById('transaction-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const amount = document.getElementById('amount').value;
            const description = document.getElementById('description').value;

            const result = await apiCall(`/transactions/customer/${customerId}`, 'POST', {
                amount: parseFloat(amount),
                type: type,
                description: description
            });

            if (result) {
                window.location.href = `customer-detail.html?id=${customerId}`;
            } else {
                alert("Transaction Failed");
            }
        });
    </script>
</body>

</html>